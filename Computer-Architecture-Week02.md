![](https://velog.velcdn.com/images/krylo71911/post/df97ac97-4a73-42e8-a621-d6c30caf6d3c/image.jpeg)
# Chapter 03 | 명령어
## 03-1 소스 코드와 명령어
> 명령어는 컴퓨터를 실질적으로 작동시키는 매우 중요한 정보.

> 저급 언어 
- 기계어 : 0과 1로 이루어진 명령어로 구성.
- 어셈블리어 : 기계어를 사람이 읽기 편한 형태로 번역.

- 컴파일 언어 : 컴파일 방식으로 작동하는 프로그래밍 언어. 컴파일러에 의해 소스 코드 전체가 저급 언어로 변환되어 실행되는 고급 언어. 대표적으로 C가 있다. 컴파일이 성공적으로 수행되면 개발자가 작성한 소스 코드는 컴퓨터가 이해할 수 잇는 저급 언어로 변환된다. 이렇게 컴파일러를 통해 저급 언어로 변환된 코드를 목적 코드(object code)라고 한다.
- 인터프리터 언어 : 인터프리트 방식으로 작동한느 프로그래밍 언어. 일반적으로 인터프리터 언어는 컴파일 언어보다 느리다. 한 줄 한 줄씩 해석하며 실행해야 하기 때문이다. 
컴파일 언어와 인터프리터 언어는 칼로 자르듯 구분할 수 없는 경우가 많다. 

#### 목적 파일 VS 실행 파일
목적 코드가 실행 파일이 되기 위해서는 링킹이라는 작업을 거쳐야 한다. 

## 03-2 명령어의 구조
> 명령어는 연산코드와 오퍼랜드로 구성
- 연산 코드 : '명령어가 수행할 연산'
- 오퍼랜드 : '연산에 사용할 데이터가 저장된 위치'

- 0-주소 명령어
- 1-주소 명령어
- 2-주소 명령어
- 3-주소 명령어

> 연산 코드의 유형
1. 데이터 전송
2. 산술/논리 연산
3. 제어 흐름 변경
4. 입출력 제어

> CPU는 다양한 주소 지정 방식을 사용한다.
- 즉시 주소 지정 방식(연산에 사용할 데이터) : 연산에 사용할 데이터를 오퍼랜드 필드에 직접 명시하는 방식. 빠르다.
- 직접 주소 지정 방식(유효 주소(메모리 주소)) : 오퍼랜드 필드에 유효 주소를 직접적으로 명시하는 방식. 표현할 수 있는 오퍼랜드 필드의 길이가 연산 코드의 길이만큼 짧아져 표현할 수 있는 유효 주소에 제한이 생길 수 있다.
- 간접 주소 지정 방식(유효 주소의 주소) : 유효 주소의 주소를 오퍼랜드 필드에 명시한다. 두 번의 메모리 접근이 필요하기 때문에 위 두 개의 주소 지정 방식보다 일반적으로 느린 방식이다.
- 레지스터 주소 지정 방식(유효 주소(레지스터 이름)) : 직접 주소 지정 방식과 비슷하게 사용할 데이터를 저장한 레지스터를 오퍼랜드 필드에 직접 명시하는 방법이다. 표현할 수 있는 레지스터 크기에 제한이 생길 수 있다.
- 레지스터 간접 주소 지정 방식(유효 주소를 저장한 레지스터) : 연산에 사용할 데이터를 메모리에 저장하고, 그 주소(유효 주소)를 저장한 레지스터를 오퍼랜드 필드에 명시하는 방법이다. 간접 주소 지정 방식과 비슷하지만 메모리에 접근하는 횟수가 한 번으로 줄어든다는 차이점이 있어 간접 주소 지정 방식보다 빠르다. 

#### 스택과 큐
- 스택 : 한 쪽 끝이 막혀 있는 통과 같은 저장공간, LIFO
- 큐 : 양쪽이 뚫려있는 통과 같은 저장 공간, FIFO

# Chapter 04 | CPU의 작동 원리
## 04-1 ALU와 제어장치
#### ALU
- ALU : 계산하는 부품. 연산 결과와 플래그를 내보낸다. ALU는 레지스터를 통해 피연산자를 받아들이고, 제어장치로부터 수행할 연산을 알려주는 제어 신호를 받아들인다. ALU는 레지스터와 제어장치로부터 받아들인 피연산자와 제어 신호로 산술 연산, 논리 연산 등 다양한 연산을 수행한다.
- 플래그 : 연산 결과에 대한 추가적인 상태 정보로 부호 플래그, 제로 플래그, 캐리 플래그, 오버플로우 플래그, 인터럽트 플래그, 슈퍼바이저 플래그가 있다.

#### 제어장치
제어장치는 제어 신호를 내보내고, 명령어를 해석하는 부품, 제어 신호는 컴퓨터 부품들을 관리하고 작동시키기 위한 일종의 전기신호.
1. 제어장치는 클럭 신호를 받아들인다.
2. 제어장치는 "해석해야 할 명령어"를 받아들인다.
3. 제어장치는 플래그 레지스터 속 플래그 값을 받아들인다.
4. 제어장치는 시스템 버스, 그 중에서 제어 버스로 전달된 제어 신호를 받아들인다.

## 04-2 레지스터
#### 프로그램 카운터
메모리에서 가져올 명령어의 주소, 즉 메모리에서 읽어 들일 명령어의 주소를 저장한다. 프로그램 카운터를 명령어 포인터라고 부르는 CPU도 있다.

#### 명령어 레지스터
해석할 명령어, 즉 방금 메모리에서 읽어 들인 명령얼르 저장하는 레지스터이다. 제어장치는 명령어 레지스터 속 명령어를 받아들이고 이를 해석한 뒤 제어 신호를 내보낸다.

#### 메모리 주소 레지스터
메모리의 주소를 저장하는 레지스터이다. CPU가 읽어 들이고자 하는 주소 값을 주소 버스로 보낼 때 메모리 주소 레지스터를 거치게 된다.

#### 메모리 버퍼 레지스터
메모리와 주고받을 값(데이터와 명령어)을 저장하는 레지스터이다. 즉, 메모리에 쓰고 싶은 값이나 메모리로부터 전달받은 값은 메모리 버퍼 레지스터를 거친다.

#### 범용 레지스터
이름 그대로 다양하고 일반적인 상황에서 자유롭게 사용할 수 있는 레지스터. 메모리 버퍼 레지스터는 데이터 버스로 주고받을 값만 저장하고, 메모리 주소 레지스터는 주소 버스로 내보낼 주소값만 저장하지만, 범용 레지스터는 데이터와 주소를 모두 저장할 수 있다. 현재 대다수 CPU 는 모두 범용 레지스터를 가지고 있다.

#### 플래그 레지스터
연산 결과 또는 CPU 상태에 대한 부가적인 정보를 저장하는 레지스터이다.

> 특정 레지스터를 이용한 주소 지정 방식
1. 스택 주소 지정 방식 : 스택과 스택 포인터를 이용한 주소 지정 방식
2. 변위 주소 지정 방식 : 오퍼랜드 필드의 값(변위)과 특정 레지스터의 값을 더하여 유효 주소를 얻어내는 주소 지정 방식. 오퍼랜드 필드의 주소와 어떤 레지스터를 더하는지에 따라 상대 주소 지정 방식(오퍼랜드와 프로그램 카운터의 값을 더하여 유효 주소를 얻는 방식), 베이스 레지스터 주소 지정 방식(오퍼랜드와 베이스 레지스터의 값을 더하여 유효 주소를 얻는 방식) 등으로 나뉜다.

## 04-3 명령어 사이클과 인터럽트

#### 명령어 사이클
명령어 사이클이란? CPU가 하나의 명령어를 처리하는 과정에는 어떤 정해진 흐름이 있고, CPU는 그 흐름을 반복하여 명령어들을 처리해 나가는데, 이렇게 하나의 명령어를 처리하는 정형화된 흐름을 의미한다.

> 인터럽트의 종류
- 동기 인터럽트(예외) : CPU에 의해 발생하는 인터럽트, 예외라고 부르기도 한다. 
- 비동기 인터럽트(하드웨어 인터럽트) : 입출력장치에 의해 발생하는 인터럽트. 세탁기 완료 알림...여기엔 막을 수 있는 인터럽트와 막을 수 없는 인터럽트로 나뉜다. 

> #### 하드웨어 인터럽트 처리 순서
1. 입출력 장치는 CPU에 인터럽트 요청 신호를 보낸다.
2. CPU는 실행 사이클이 끝나고 명령어를 인출하기 전 항상 인터럽트 여부를 확인한다.
3. CPU는 인터럽트 요청을 확인하고 인터럽트 플래그를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인한다.
4. 인터럽트를 받아들일 수 있다면 CPU는 지금까지의 작업을 백업한다.
5. CPU는 인터럽트 벡터를 참조하여 인터럽트 서비스 루틴을 실행한다.
5. 인터럽트 서비스 루틴 실행이 끝나면 4에서 백업해 둔 작업을 복구하여 실행을 재개한다.

> 예외의 종류
- 폴트 : 예외를 처리한 직후 예외가 발생한 명령어부터 실행을 재개하는 예외
- 트랩 : 예외를 처리한 직후 예외가 발생한 명령어의 다음 명령어부터 실행을 재개하는 예외. 주로 디버깅할 때 사용.
- 중단 : CPU가 실행 중인 프로그램을 강제로 중단시킬 수밖에 없는 심각한 오류를 발견했을 대 발생하는 예외. 
- 소프트웨어 인터럽트 : 시스템 호출이 발생했음을 나타낸다.

# Chapter 05 | CPU 성능 향상 기법

## 05-1 빠른 CPU를 위한 설계 기법
#### 클럭
클럭 속도가 높은 CPU는 빠르게 작동한다.
#### 코어와 멀티코어
코어란 CPU 내에서 명령어를 실행한느 부품이다.
멀티코어 프로세서란 여러 개의 코어를 포함하는 CPU를 말한다.
#### 스레드와 멀티스레드
- 스레드의 사전적 의미는 '실행 흐름의 단위' 스레드에는 CPU에서 사용되는 하드웨어적 스레드가 있고, 프로그램에서 사용되는 소프트웨어적 스레드가 있다.
- 하나의 코어로 여러 명령어를 동시에 처리하는 CPU를 멀티스레드 프로세서 또는 멀티스레드 CPU라고 한다. 하이퍼스레딩

## 05-2 명령어 병렬 처리 기법
명령어 병렬  처리 기법이란? 명령어를 동시에 처리하여 CPU를 한시도 쉬지 않고 작동 시키는 기법. 명령어 파이프 라이닝, 슈퍼스칼라, 비순차적 명령어 처리가 있다.
- 파이프라인 위험 : 데이터 위험, 제어 위험, 구조적 위험이 있다.
> - 데이터 위험 : 명령어 간 '데이터 의존성'에 의해 발생. 데이터 의존적인 두 명령어를 무작정 동시에 실행하려고 하면 파이프라인이 제대로 작동하지 않는 것을 '데이터 위험'이라고 한다.
> - 제어 위험 : 주로 분기 등으로 인한 '프로그램 카운터의 갑작스러운 변화'에 의해 발생.
> - 구조적 위험 : 자원 위험이라고도 불리며 명령어들을 겹쳐 실행하는 과정에서 서로 다른 명령어가 동시에 ALU, 레지스터 등과 같은 CPU 부품을 사용하려고 할 때 발생한다. 

#### 슈퍼스칼라
CPU 내부에 여러 개의 명령어 파이프라인을 포함한 구조. 공장 생산 라인을 여러 개 두는 것과 같다.

#### 비순차적 명령어 처리 OoOE
명령어들을 순차적으로 실행하지 않는 기법. 명령어의 '합법적인 새치기' 

## 05-3 CISC와 RISC
#### 명령어 집합, 명령어 집합 구조(ISA)
CPU가 이해할 수 있는 명령어들의 모음, CPU마다 ISA가 다를 수 있다. 

#### CISC (Complex Instruction Set Computer)
복잡하고 다양한 명령어들을 활용하는 CPU 설계 방식. 명령어의 규격화가 어려워 파이프라이닝이 어렵다. 그리고 대다수의 복잡한 명령어는 사용 빈도가 낮다. 이러한 이유로 CISC 기반 CPU는 성장에 한계가 있다.

#### RISC (Reduced Instruction Set Computer)
고정 길이 명령어를 활용한다. 명령어가 규격화되어 있고, 하나의 명령어가 1클럭 내외로 실행되기 때문에 명령어 파이프라이닝에 최적화되어 있다. 

